<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="../style/style.css" rel="stylesheet" />
    <link href="../style/main.css" rel="stylesheet" />
    <title>í«ì‹œí„° ë§¤ì¹­ ì„œë¹„ìŠ¤ ğŸ¶</title>
  </head>

  <body>
    <div class="header-image"></div>
    <div class="header">
      <!-- í”„ë¡œí•„ í¸ì§‘ ë²„íŠ¼ -->
      <div class="profile-edit-button">
        <button class="btn btn-outline-dark" id="profile">í”„ë¡œí•„ í¸ì§‘</button>
      </div>
      <!-- í—¤ë” -->
      <header class="text-center my-5" id="header-image">
        <h1>í«ì‹œí„° ë§¤ì¹­ ì„œë¹„ìŠ¤ ğŸ¶</h1>
      </header>
    </div>
    <div class="container">
      <!-- í«ì‹œí„° ì •ë³´ ë²„íŠ¼ -->
      <div class="petsitter-button">
        <button class="btn btn-primary" id="pettsitter">í«ì‹œí„° ì •ë³´</button>
      </div>
      <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
      <div class="write-button">
        <button class="btn btn-dark" id="newBooking">ì˜ˆì•½í•˜ê¸°</button>
      </div>
      <!-- ì‚¬ì§„ê³¼ ì œëª© -->
      <div class="row">
        <div class="col-md-6 offset-md-3">
          <!--<img src="/images/winter.png" class="img-fluid" alt="ë¸”ë¡œê·¸ ì´ë¯¸ì§€" />-->
          <h2 class="my-3">ì˜ˆì•½ ìƒì„¸ ì¡°íšŒ</h2>
        </div>
      </div>

      <!-- ê²Œì‹œê¸€ ëª©ë¡ í…Œì´ë¸” -->
      <table class="table table-hover mt-4">
        <thead class="thead-dark">
          <tr>
            <th scope="col">#</th>
            <th scope="col">ì œëª©</th>
            <th scope="col">ì‘ì„±ì¼</th>
          </tr>
        </thead>
        <tbody id="bookingTableBody"></tbody>
      </table>
    </div>
    <footer>
      <p>
        <span>í•œë²”ì„ : </span><a href="https://lemonlog.tistory.com" target="_blank">Blog</a> | <span>ì •ê·œì„± : </span
        ><a href="https://wjdrbtjd11.tistory.com/" target="_blank">Blog</a> | <span>ë°•ì§€í˜œ : </span
        ><a href="https://mybluesummer.tistory.com" target="_blank">Blog</a>
      </p>
    </footer>
    <script>
      $(document).ready(function () {
        function loadBookingList() {
          $.ajax({
            url: "http://localhost:4002/api/booking/",
            type: "GET",
            data: { sort: "asc" }, // ì˜¤ë¦„ì°¨ìˆœ
            success: function (response) {
              if (response.success) {
                displayBookings(response.data.formattedBookings);
              } else {
                alert("ì˜ˆì•½ ëª©ë¡ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
              }
            },
            error: function () {
              alert("ì˜ˆì•½ ëª©ë¡ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
          });
        }
        function displayBookings(bookings) {
          var tableBody = $("#bookingTableBody");
          tableBody.empty();

          for (var i = 0; i < bookings.length; i++) {
            var booking = bookings[i];
            var row =
              "<tr>" +
              "<th scope='row'>" +
              (i + 1) +
              "</th>" +
              "<td><a href='serviceDetail.html?bookingId=" +
              booking.bookingId +
              "'>" +
              booking.title +
              "</a></td>" +
              "<td>" +
              booking.createdAt +
              "</td>" +
              "</tr>";
            tableBody.append(row);
          }
        }

        loadBookingList();
      });

      window.addEventListener("load", async (event) => {
        //repeatScalingAnimation();
        const scalingElement = document.querySelector(".header-image");

        scalingElement.addEventListener("animationiteration", function () {
          // ì• ë‹ˆë©”ì´ì…˜ ë°˜ë³µ ì‹œ ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½
          const currentImage = scalingElement.style.backgroundImage;
          let changeImageUrl = 'url("../images/dog1.png")';

          if (currentImage.includes("dog1.png")) changeImageUrl = 'url("../images/dog2.png")';
          else if (currentImage.includes("dog2.png")) changeImageUrl = 'url("../images/dog3.png")';
          else scalingElement.style.backgroundImage = 'url("../images/dog1.png")';

          scalingElement.style.backgroundImage = changeImageUrl;
        });

        // í˜ì´ì§€ ë¡œë“œ í›„ ìŠ¤ì¼€ì¼ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
        scalingElement.classList.add("animated");
      });
      function openSitterRateListPopup() {
        // íŒì—… ì°½ì˜ í¬ê¸° ë° ìœ„ì¹˜ ì„¤ì •
        var width = 800;
        var height = 600;
        var left = window.innerWidth / 2 - width / 2 + window.screenX;
        var top = window.innerHeight / 2 - height / 2 + window.screenY;

        // sitterRateList.htmlì„ íŒì—…ìœ¼ë¡œ ì—´ê¸°
        var popup = window.open(
          "sitterRateList.html",
          "_blank",
          "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top + ",scrollbars=yes,resizable=yes"
        );
      }
      // í”„ë¡œí•„ í¸ì§‘ ë²„íŠ¼
      document.getElementById("profile").addEventListener("click", function () {
        location.href = "profile.html";
      });

      // í«ì‹œí„° ì •ë³´ ë²„íŠ¼
      document.getElementById("pettsitter").addEventListener("click", function () {
        //location.href = "sitterRateList.html";
        openSitterRateListPopup();
      });

      // ì˜ˆì•½í•˜ê¸° ë²„íŠ¼
      document.getElementById("newBooking").addEventListener("click", function () {
        location.href = "bookingDetail.html";
      });
    </script>
  </body>
</html>
